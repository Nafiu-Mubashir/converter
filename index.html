<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CSV Filter + Duplicate Checker</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 font-sans p-8">

  <div class="container mx-auto bg-white shadow-md rounded-lg p-6">
    <h2 class="text-2xl font-bold text-blue-600 mb-6">CSV Filter + Duplicate Checker</h2>

    <input type="file" id="csvFile" accept=".csv" class="border border-gray-300 rounded-md px-4 py-2 mb-4 w-full md:w-1/2" />

    <div id="filterArea" class="hidden">

      <div class="mb-6">
        <h3 class="text-xl font-semibold text-blue-500 mb-3">Filter Data</h3>

       <div class="flex items-center flex-wrap gap-4">
         <div class="flex flex-wrap gap-3 items-center">
          <label class="font-medium">Column:</label>
          <select id="filterColumn" class="border border-gray-300 rounded-md px-3 py-2"></select>

          <label class="font-medium">Contains:</label>
          <input type="text" id="filterValue" placeholder="Type to filter..." class="border border-gray-300 rounded-md px-3 py-2" />
        </div>

        <div class="flex flex-wrap gap-3">
          <button onclick="applyFilter()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md shadow">Apply Filter</button>
          <button onclick="resetTable()" class="bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded-md shadow">Reset</button>
          <button onclick="downloadCSV()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-md shadow">Download Filtered</button>
        </div>
       </div>
      </div>

      <div class="mb-6">
        <h3 class="text-xl font-semibold text-blue-500 mb-3">Duplicate Checker</h3>

        <div class="flex items-center flex-wrap gap-4">
          <div class="flex flex-wrap gap-3 items-center">
          <label class="font-medium">Check Duplicates in:</label>
          <select id="duplicateColumn" class="border border-gray-300 rounded-md px-3 py-2"></select>
        </div>

        <div class="flex flex-wrap gap-3">
          <button onclick="findDuplicates()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-md shadow">Find Duplicates</button>
          <button onclick="removeDuplicates()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-md shadow">Remove Duplicates</button>
        </div>
        </div>
      </div>

    </div>

    <div class="overflow-x-auto">
      <table id="outputTable" class="min-w-full border border-gray-300 rounded-md shadow-sm mt-4 text-sm"></table>
    </div>
  </div>

 <!-- Modal -->
  <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
    <div class="bg-white rounded-lg shadow-lg p-6 w-96">
      <h3 class="text-lg font-semibold text-blue-600 mb-3" id="modalTitle">Message</h3>
      <p class="mb-4" id="modalMessage"></p>
      <button onclick="closeModal()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md shadow float-right">Close</button>
    </div>
  </div>

  <script>
    let originalData = [];
    let filteredData = [];

    // CSV file parsing
    document.getElementById("csvFile").addEventListener("change", function (event) {
      const file = event.target.files[0];
      const reader = new FileReader();
      reader.onload = function (e) {
        parseCSV(e.target.result);
      };
      reader.readAsText(file);
    });

    function parseCSV(text) {
      const rows = text.split("\n").map(r => r.trim()).filter(r => r.length > 0);
      const headers = rows[0].split(",");
      originalData = rows.slice(1).map(row => {
        const values = row.split(",");
        let obj = {};
        headers.forEach((h, i) => { obj[h] = values[i] || ""; });
        return obj;
      });
      filteredData = [...originalData];
      populateTable(filteredData, headers);
      populateFilterOptions(headers);
      document.getElementById("filterArea").classList.remove("hidden");
    }

    function populateTable(data, headers) {
      const table = document.getElementById("outputTable");
      table.innerHTML = "";
      let thead = `<tr class="bg-blue-100 text-blue-700 font-semibold"> <th class="border px-3 py-2">S/N</th>`;
      headers.forEach(h => thead += `<th class="border px-3 py-2">${h}</th>`);
      thead += "</tr>";
      table.innerHTML += thead;
      data.forEach((row, index) => {
        let rowHTML = `<tr class="hover:bg-blue-50"><td class="border px-3 py-2">${index + 1}</td>`;
        headers.forEach(h => rowHTML += `<td class="border px-3 py-2">${row[h]}</td>`);
        rowHTML += "</tr>";
        table.innerHTML += rowHTML;
      });
    }

    function populateFilterOptions(headers) {
      const filterSelect = document.getElementById("filterColumn");
      const duplicateSelect = document.getElementById("duplicateColumn");
      filterSelect.innerHTML = "";
      duplicateSelect.innerHTML = "";
      headers.forEach(h => {
        filterSelect.appendChild(new Option(h, h));
        duplicateSelect.appendChild(new Option(h, h));
      });
    }

    function applyFilter() {
      const column = document.getElementById("filterColumn").value;
      const value = document.getElementById("filterValue").value.toLowerCase();
      filteredData = originalData.filter(row =>
        row[column] && row[column].toLowerCase().includes(value)
      );
      populateTable(filteredData, Object.keys(originalData[0]));
    }

    function resetTable() {
      filteredData = [...originalData];
      populateTable(filteredData, Object.keys(originalData[0]));
      document.getElementById("filterValue").value = "";
    }

    function findDuplicates() {
      const column = document.getElementById("duplicateColumn").value;
      const seen = new Set();
      const duplicates = [];
      originalData.forEach(row => {
        const value = row[column];
        if (seen.has(value)) {
          duplicates.push(row);
        } else {
          seen.add(value);
        }
      });
      filteredData = duplicates;
      populateTable(filteredData, Object.keys(originalData[0]));
      showModal("Duplicates Found", `Found ${duplicates.length} duplicate entries in column: ${column}`);
    }

    function removeDuplicates() {
      const column = document.getElementById("duplicateColumn").value;
      const seen = new Set();
      const uniqueRows = [];
      originalData.forEach(row => {
        const value = row[column];
        if (!seen.has(value)) {
          seen.add(value);
          uniqueRows.push(row);
        }
      });
      filteredData = uniqueRows;
      populateTable(filteredData, Object.keys(originalData[0]));
      showModal("Duplicates Removed", `${originalData.length - uniqueRows.length} duplicates removed successfully.`);
      originalData = [...uniqueRows];
    }

    function downloadCSV() {
      if (!filteredData.length) return showModal("Error", "No data to download.");
      const headers = Object.keys(originalData[0]).join(",");
      const rows = filteredData.map(row => Object.values(row).join(",")).join("\n");
      const csvContent = headers + "\n" + rows;
      const blob = new Blob([csvContent], { type: "text/csv" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "filtered.csv";
      a.click();
    }

    // Modal functions
    function showModal(title, message) {
      document.getElementById("modalTitle").innerText = title;
      document.getElementById("modalMessage").innerText = message;
      document.getElementById("modal").classList.remove("hidden");
    }

    function closeModal() {
      document.getElementById("modal").classList.add("hidden");
    }
  </script>

</body>
</html>
